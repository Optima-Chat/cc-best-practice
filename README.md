# Claude Code 最佳实践

> 先想清楚，再动手

## 核心原则

先讨论技术方案，理解所有细节，确认无误后再写代码。讨论方案 1-2 小时，写代码 10-20 分钟。方案没想清楚就动手，返工时间可能是几小时甚至几天。

**黄金法则：讨论方案的时间能省下十倍的返工时间**。

## 如何讨论技术方案

告诉 Claude Code："我想实现某功能，先讨论技术方案，不要写代码。" 然后提问：整体架构是什么？需要哪些模块？数据流如何？技术选型？可能的坑？

对任何不理解的地方都要问清楚。为什么用 Redis 而非 Memcached？中间件执行顺序为何这样安排？WebSocket 和轮询的区别？数据结构为何这样设计？必须完全理解每个决策。

方案讨论完后，用自己的话总结一遍，确认理解正确，然后开始实现。

## 保存技术方案

讨论完的技术方案必须记录下来。在项目根目录建 `docs` 文件夹，保存技术方案、架构设计、技术决策。告诉 Claude Code："把我们讨论的方案整理成文档，保存到 @docs 目录。"

原因：过段时间会忘记设计初衷，新人加入需要了解架构，后续扩展需要参考原方案。讨论过程中的架构图、数据流图、时序图都要保存，图比文字更直观。

## 案例对比

### 购物车功能

**常规做法（3 小时）：**
"帮我实现购物车功能" → 写代码 → "要支持多规格" → 改代码 → "数据要存服务端" → 大改 → "要支持优惠券" → 继续改。

**推荐做法（1.5 小时）：**
"实现购物车功能，需求：多规格商品、服务端存储、优惠券、库存检查、游客和登录用户。请给技术方案。" → 讨论 1 小时，理解所有细节 → "保存方案到 docs，开始实现" → 20 分钟完成，基本不改。

### API 性能优化

**常规做法：**
"API 很慢，帮我优化" → 加缓存、加索引 → 效果不明显 → 继续尝试 → 浪费时间。

**推荐做法：**
"API 响应 3 秒，分析原因：数据库、网络还是计算？列出优化方案，评估收益成本，给出优先级。" → 发现 N+1 查询问题 → 问清楚什么是 N+1 → 讨论 JOIN 方案 → 确定方案：JOIN + Redis → 保存到 docs → 实现 → 响应降至 200ms。

## 适用场景

适合：新功能开发、架构设计、性能优化、代码重构、技术选型。

不适合：简单 bug 修复、文案修改、样式调整。

判断标准：任务涉及多个模块、需要技术决策、影响系统架构，就先讨论方案。

## 其他技巧

**画图：** 要求 Claude Code 用 Mermaid 画架构图、数据流图、时序图、ER 图。Mermaid 语法简单，渲染效果清晰美观，易于理解和维护。GitHub 和大多数 Markdown 编辑器原生支持。把图保存到 docs 目录作为技术文档。

示例：
```
"用 Mermaid 画出系统架构图，展示各模块间的调用关系"
"画一个用户登录的时序图，展示前端、后端、数据库的交互流程"
```

**多方案对比：** "给出三种方案：最简单的、性能最优的、最灵活的。分析优缺点。" 权衡利弊后选择，把选型理由记录到 docs。

## 实践要点

讨论方案时花足够时间，完全理解每个技术决策。方案整理成文档保存到 docs。确认无误后再写代码。发现问题立即停下重新讨论。

慢就是快。方案上多花时间，代码上省时间。

---

## 文档目录

`docs` 目录存放技术方案文档、架构设计、最佳实践案例。

结构：
- `docs/basics/` - 基础知识
- `docs/advanced/` - 进阶技巧
- `docs/examples/` - 实战案例
- `docs/best-practices/` - 最佳实践

## 社区

- [CC Chat 社区](https://github.com/optima-chat/cc-chat) - Claude Code 中文社区
- [GitHub Discussions](../../discussions) - 讨论交流

## 许可证

MIT
