# Claude Code 最佳实践

> 使用 Claude Code 的正确姿势：先想清楚，再动手

## 核心理念

### ⚠️ 最重要的一条：先讨论技术方案，再写代码

很多人用 Claude Code 的方式是错的：

❌ **错误做法**
```
"帮我实现一个用户认证功能"
→ Claude Code 立即开始写代码
→ 写到一半发现方案不对
→ 推倒重来
→ 浪费大量时间
```

✅ **正确做法**
```
"我想实现用户认证功能，我们先讨论一下技术方案：
- 使用 JWT 还是 Session？
- 如何处理 token 刷新？
- 如何处理权限控制？
- 数据库表结构如何设计？
...（和 Claude Code 讨论 1-2 小时）

确认方案后：
"好的，按照我们讨论的方案开始实现"
→ 代码一气呵成
→ 很少需要返工
```

### 为什么要这样做？

1. **讨论方案：1-2 小时**
   - 思考清楚所有细节
   - 发现潜在问题
   - 确保自己理解每个决策

2. **写代码：可能只需要 10-20 分钟**
   - 方案清晰，实现迅速
   - 代码质量高
   - 很少需要返工

3. **如果方案没想好就开始写：**
   - 写到一半发现问题
   - 大量返工
   - 可能需要几个小时甚至几天

### 黄金法则

```
花在讨论方案上的时间 × 10 = 省下来的返工时间
```

## 实践步骤

### 第一步：提出需求，请求方案

```
我想实现 [功能描述]

请先不要写代码，我们一起讨论技术方案：

1. 整体架构应该是什么样的？
2. 需要哪些核心模块？
3. 数据流是怎样的？
4. 有哪些技术选型需要考虑？
5. 可能遇到的坑是什么？

请详细说明，画出架构图。
```

### 第二步：深入理解方案

**对于方案中任何不理解的地方，都要问清楚：**

```
"你提到使用 Redis 做缓存，为什么不用 Memcached？"
"这个中间件的执行顺序为什么要这样安排？"
"为什么要用 WebSocket 而不是轮询？"
"这个数据结构为什么要这样设计？"
```

**不要害怕问"笨"问题，一定要完全理解每个决策的原因。**

### 第三步：确认方案

当你对方案的每个部分都理解后：

```
"我理解了，让我总结一下方案：
1. ...
2. ...
3. ...

这样理解对吗？还有什么需要补充的？"
```

### 第四步：开始实现

```
"好的，按照我们讨论的方案开始实现：
1. 先创建 xxx
2. 然后实现 yyy
3. 最后添加 zzz

请创建 todo list 跟踪进度。"
```

## 真实案例对比

### 案例 1：电商网站购物车功能

#### ❌ 错误方式（耗时 3 小时）

```
用户："帮我实现购物车功能"

Claude Code：开始写代码...

[30分钟后]
用户："等等，我需要支持多规格商品（尺寸、颜色）"
Claude Code：修改代码...

[1小时后]
用户："购物车数据要存在服务端，不是本地存储"
Claude Code：大改代码...

[2小时后]
用户："还要支持优惠券计算"
Claude Code：继续改...

总耗时：3小时，代码改了N遍
```

#### ✅ 正确方式（耗时 1.5 小时）

```
用户："我想实现购物车功能，先讨论方案：

需求：
- 支持多规格商品（尺寸、颜色等）
- 购物车数据存在服务端
- 支持优惠券
- 支持库存检查
- 游客和登录用户都能用

请给出完整的技术方案。"

Claude Code：[给出详细方案，包括数据结构、API 设计、状态管理等]

用户："为什么游客购物车要用 sessionId，不用 localStorage？"
Claude Code：[解释原因]

用户："多规格商品的 SKU 如何设计？"
Claude Code：[详细说明]

[讨论 1 小时后，方案确定]

用户："好的，开始实现"
Claude Code：[20分钟写完，一次到位]

总耗时：1.5 小时，代码基本不用改
```

**节省了 50% 的时间，代码质量更高！**

### 案例 2：API 性能优化

#### ❌ 错误方式

```
用户："这个 API 很慢，帮我优化"
Claude Code：加缓存、加索引...
[优化了半天，效果不明显]
用户："为什么还是慢？"
Claude Code：继续尝试其他方法...
```

#### ✅ 正确方式

```
用户："这个 API 响应时间 3 秒，我们先分析一下原因：

1. 请帮我分析慢在哪里（数据库？网络？计算？）
2. 列出可能的优化方案
3. 评估每个方案的收益和成本
4. 给出优先级建议"

Claude Code：[详细分析]

用户："你说 N+1 查询是主因，什么是 N+1？"
Claude Code：[解释]

用户："如果用 JOIN 代替，对数据库压力有多大？"
Claude Code：[分析]

[讨论 30 分钟后确定方案]

用户："明白了，我们用方案 2：JOIN + Redis 缓存"
Claude Code：[实现优化，API 响应降到 200ms]
```

## 核心建议

### 1. 不要着急写代码

- ⏰ **讨论方案：1-2 小时很正常**
- 💻 **写代码：可能只需要几分钟到半小时**
- 🔧 **返工：如果方案不对，可能需要几小时甚至几天**

### 2. 问到你完全理解为止

```
"为什么要这样做？"
"有没有其他方案？"
"这个方案的缺点是什么？"
"如果遇到 XXX 情况怎么办？"
```

### 3. 让 Claude Code 画图

```
"请画出：
- 架构图
- 数据流图
- 时序图
- ER 图"
```

图比文字更容易理解。

### 4. 要求给出多个方案

```
"请给出 3 种不同的实现方案：
- 方案 1：最简单快速的
- 方案 2：性能最优的
- 方案 3：最灵活可扩展的

分析每个方案的优缺点。"
```

### 5. 确认你的理解

```
"让我确认一下我的理解：
[用自己的话总结方案]

这样理解对吗？"
```

## 适用场景

这个方法特别适合：

- ✅ 新功能开发
- ✅ 架构设计
- ✅ 性能优化
- ✅ 重构
- ✅ 技术选型

不太适合：

- ❌ 简单的 bug 修复
- ❌ 文案修改
- ❌ 样式调整

## 开始实践

下次使用 Claude Code 时，记住：

1. 🤔 **先讨论，问清楚**
2. ⏰ **花 1-2 小时讨论方案，不要觉得浪费时间**
3. 💡 **完全理解方案的每个部分**
4. 📝 **确认方案无误后再开始写代码**
5. 🚀 **代码实现一气呵成**

---

> "慢就是快，快就是慢" —— 《孙子兵法》没说过

想清楚再动手，磨刀不误砍柴工。

## 贡献

欢迎分享你的最佳实践！查看[贡献指南](./CONTRIBUTING.md)

## 许可证

MIT

## 社区

- [CC Chat 社区](https://github.com/optima-chat/cc-chat) - Claude Code 中文聊天社区
- [GitHub Discussions](../../discussions) - 讨论和交流
