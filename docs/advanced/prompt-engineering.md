# 提示词工程

如何更好地与 Claude Code 交流，获得最佳结果。

## 基本原则

### 1. 清晰明确

❌ **模糊的请求**
```
优化一下代码
```

✅ **明确的请求**
```
重构 src/services/UserService.ts 中的认证逻辑，
将重复的验证代码提取为独立的中间件函数
```

### 2. 提供上下文

❌ **缺少上下文**
```
帮我修复这个 bug
```

✅ **提供充分上下文**
```
登录功能有问题：
- 错误信息：TypeError: Cannot read property 'token' of undefined
- 文件：src/auth/login.ts:45
- 复现步骤：用户输入邮箱和密码后点击登录
- 预期行为：应该获取到 token 并跳转到首页
```

### 3. 分步骤表达

对于复杂任务，分解为清晰的步骤：

```
帮我实现购物车功能：

1. 创建 Cart 数据模型（支持添加、删除、更新商品）
2. 实现购物车 API（RESTful）
3. 创建购物车 UI 组件
4. 添加单元测试和集成测试
5. 更新文档

每个步骤完成后确认再继续。
```

## 常见场景

### 代码审查

```
请审查 src/components/ProductList.tsx，关注：

1. 性能问题（是否有不必要的重渲染）
2. 可访问性（ARIA 标签、键盘导航）
3. 错误处理（边界情况）
4. 代码风格（是否遵循 React 最佳实践）

对每个问题提供具体的代码位置和改进建议。
```

### 调试问题

```
应用在生产环境出现性能问题：

环境信息：
- Node.js 18.x
- Next.js 14
- 部署在 Vercel

症状：
- 首页加载时间超过 5 秒
- Lighthouse 性能分数从 90 降到 45

请帮我：
1. 分析可能的原因
2. 检查最近的代码变更（git log）
3. 提供诊断和优化建议
```

### 功能实现

```
实现一个文件上传组件，需求：

功能：
- 支持拖拽上传
- 支持多文件
- 文件类型限制（图片：jpg, png, webp）
- 文件大小限制（单个 5MB）
- 上传进度显示
- 上传失败重试

技术栈：
- React + TypeScript
- 使用 react-dropzone 库
- 样式使用 Tailwind CSS

请先创建组件结构，然后逐步实现功能。
```

### 重构代码

```
重构 src/utils/dataProcessor.ts：

现状：
- 一个函数 500+ 行
- 嵌套的 if-else 达到 7 层
- 缺少类型定义

目标：
- 拆分为多个单一职责的函数
- 减少嵌套（最多 3 层）
- 添加完整的 TypeScript 类型
- 提取可复用的工具函数
- 添加单元测试

保持原有功能不变，确保测试覆盖。
```

## 高效技巧

### 1. 使用文件路径引用

```
src/components/Header.tsx:45 这一行的逻辑有问题，
应该先检查 user 是否存在再访问 user.name
```

### 2. 指定代码风格

在 CLAUDE.md 或消息中说明偏好：

```
代码风格要求：
- 优先使用函数式编程
- 避免 any 类型
- 使用 const 而非 let
- 导入排序：React -> 第三方库 -> 本地模块
```

### 3. 提供示例

```
创建一个用户列表组件，参考现有的 ProductList.tsx 的结构：
- 使用相同的分页逻辑
- 相同的加载状态处理
- 相同的错误提示样式
```

### 4. 批量操作

```
在以下文件中将所有的 `oldFunctionName` 重命名为 `newFunctionName`：
- src/services/*.ts
- src/components/**/*.tsx
- src/utils/helper.ts

重命名后运行测试确保没有破坏功能。
```

### 5. 限定范围

```
只检查 src/api/ 目录下的文件，找出所有使用了旧版 axios 配置的地方，
并更新为新的配置格式。
```

## 避免的模式

### ❌ 过于简短

```
"改一下这个"
```

Claude Code 不知道改什么，怎么改。

### ❌ 一次性太多任务

```
重构整个项目，添加测试，优化性能，更新文档，修复所有 bug，
添加新功能 A、B、C、D，迁移到新框架...
```

任务太多容易遗漏，建议分批进行。

### ❌ 缺少验证标准

```
"优化性能"
```

应该说明如何验证：

```
"优化首页加载性能，目标是 Lighthouse 性能分数达到 90+，
FCP < 1.5s，LCP < 2.5s"
```

### ❌ 假设上下文

```
"按照之前说的那个方案实现"
```

Claude Code 可能不记得"之前的方案"，明确重述：

```
"按照上次讨论的用 Redis 做缓存的方案实现用户会话管理"
```

## 特殊场景

### 探索性任务

```
我不确定为什么应用变慢了，帮我调查：

1. 检查最近的 git 提交（最近 10 次）
2. 对比 package.json 的依赖变化
3. 分析打包体积变化
4. 检查是否有性能反模式（如 console.log 未清理）
5. 提供诊断报告和优化建议
```

### 学习和解释

```
解释 src/hooks/useOptimisticUpdate.ts 的工作原理：

1. 这个 hook 解决什么问题
2. 主要的实现逻辑
3. 使用示例
4. 潜在的边界情况

用初学者能理解的方式解释。
```

### 安全审查

```
检查代码中的安全问题：

重点关注：
- SQL 注入风险
- XSS 攻击向量
- 敏感数据暴露（如 API 密钥）
- 不安全的依赖
- CSRF 防护

对每个问题提供：
- 位置
- 风险等级
- 修复建议
```

## 与 Todo List 配合

对于复杂任务，明确说明需要任务列表：

```
实现完整的用户认证系统，请创建 todo list 跟踪进度：

- 用户注册（含邮箱验证）
- 用户登录（含记住我功能）
- 密码重置
- JWT token 管理
- 权限控制中间件
- 单元测试
- 集成测试
- API 文档

每完成一项就标记完成。
```

## 提供反馈

如果结果不理想，提供具体反馈：

❌ **模糊反馈**
```
"不是这样的"
```

✅ **具体反馈**
```
"这个实现有问题：

1. 没有处理并发请求的情况
2. 错误处理不够完善（应该区分网络错误和业务错误）
3. 缺少 loading 状态

请修改为：
- 使用 Promise.all 处理并发
- 添加详细的错误分类
- 实现 loading、success、error 三种状态"
```

## 最佳实践总结

1. **明确具体**：说清楚要做什么，怎么做
2. **提供上下文**：给出相关信息和背景
3. **设定标准**：说明如何验证成功
4. **分解任务**：复杂任务拆分为小步骤
5. **及时反馈**：不符合预期时提供具体改进意见

## 下一步

- 学习[自定义 Hooks](./hooks.md)
- 查看[实战案例](../examples/README.md)
- 探索[MCP 服务器](./mcp-servers.md)
